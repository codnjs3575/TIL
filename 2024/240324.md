# TIL

Date: 2024년 3월 24일
Topic: TIL
Tags: Jenkins

1. Jenkins 공부하기
    
    [Jenkins](https://www.notion.so/Jenkins-ec556797db2642e58ed81f23ec90a0f9?pvs=21)
    
    # 1. 지속적 통합/배포의 이해
    
    ---
    
    > 실무에서 지속적인 통합/배포가 사용되는 방식과 소프트웨어 개발 방식에 끼친 영향에 대해 설명함
    > 
    
    1-1. 애자일 개발 모델
    
    - 개발 팀에 속한 모든 팀원(개발자, 테스터, 기획자 등)이 동시에 같은 요구 사항에 대해서 작업을 하는 방식
    - 요구 사항을 우선순위에 따라 분류하고, 분류된 요구 사항별로 개발을 진행함, 분류한 일정량의 작업을 분석함
    - **스프린트** : 분석된 일정량의 작업을 구현하는 데 **할당된 작업 기간**
        - 보통 1주 ~ 3주
        - 짧은 기간 안에 많은 기능을 구현
        - 동일한 프로젝트에서 작업하는 개발자들이 각자 자신이 맡은 기능을 구현하고,
        구현 과정에서 변경한 코드를 한꺼번에 메인 브랜치에 커밋함
         (Github : 메인 브랜치, GitLab : 마스터 브랜치)
        - 문제) 변경한 코드를 한 번에 병합하면 **회귀 결함**(이전에 제대로 작동하던 기능에 문제가 발생) / **코드 충돌** 같은 문제가 생김
        - 해결) 지속적인 통합 방식을 선택
            - 작업을 완료하는 즉시 메인 브랜치에 통합함, 변경 사항이 많지 않을 때 자주 통합
            - 코드 충돌 문제를 좀 더 빠르게 발견 가능, 회귀 결함이 발생해도 효율적인 해결 가능
            
    
    1-2. 개발 워크플로
    
    1. 로컬에서 **단위 테스트** 실행
        - **테스트 주도 개발**(TDD, Test-Driven Development) 방식을 통해 요구사항 구현
            - 코드를 구현하기 전에 테스트 케이스를 먼저 작성하는 개발 방식
            - 처음에는 테스트 케이스만 작성돼 있고 구현부는 없기에 테스트 실행시 모두 실패로 나오지만, 구현부 코드를 작성해 나가면 점점 성공률이 올라감
            - 구현된 코드는 단위 테스트를 모두 통과할 때까지 반복적으로 수행
    2. 중앙 리포지터리로 코드 푸시 및 병합
       - 로컬에서 기능 구현을 완료한 후, 중앙 리포지터리로 코드를 푸시하면 메인 브랜치에 병합
    3. 병합 후 코드 컴파일
       - 주의) 새로 병합된 코드로 인해 기존에 없던 컴파일 오류가 발생하곤 함
    4. 컴파일된 코드에서 테스트 실행
       - 단위 테스트와 통합 테스트를 실행해 회귀 결함이 있는지를 확인
       - 그 외에도 정적 분석(코딩 표준 준수 및 불필요한 코드의 존재 여부를 확인하는 과정) 작업 추가
    5. 아티팩트 배포
       - 단계별 품질 점검이 끝나면 모든 코드를 패키징하고 사용자가 사용할 수 있도록 서버에 배포
       - 아티팩트는 보통 `.war`, `.jar` 파일 형식
    6. 배포 애플리케이션의 E-E 테스트 실행
       - `셀레늄`같은 UI 자동화 도구를 사용해서 애플리케이션의 전체 워크플로가 정상 동작하는지 종단간 (End-to-End) 테스트 실행
    
    # 2. 젠킨스 소개
    
    ---
    
    > CI//CD 프로세스를 자동화하고 생산성을 높이는 데 많이 사용되는 자동화 서버인 젠킨스를 소개함
    > 
    
    2-1. 젠킨스란?
    
    - 젠킨스는 소프트웨어 개발 프로세스의 다양한 단계를 자동화하는 도구
    - 중앙 소스 코드 리포지터리에서 최신 코드 가져오기, 소스 코드 컴파일, 단위 테스트 실행, 산출물을 다양한 유형으로 패키징, 산출물을 여러 종류의 환경으로 배포하기 등의 기능 수행
    - 무료로 자유롭게 사용할 수 있는 오픈 소스 라이선스 소프트웨어
    - 아파치 톰캣처럼 서블릿 컨테이너 내부에서 실행되는 서버 시스템
    - 자바로 작성됐고, 소프트웨어 개발과 관련된 다양한 도구를 지원
    
    2-2. 젠킨스를 이용한 CI/CD 구현
    
    - CI/CD 프로세스는 애플리케이션 코드에 변경이 발생하면, 그 변경 사항이 실행 파일이나 라이브러리 형태로 프로덕션 환경에 배포될 때까지 E-E 빌드 수명 주기 단계에서 검증하는 프로세스
    - 여러 개의 하위 수명 주기 단계로 구성되는데, 사전에 구성된 순서에 따라 필요한 모든 하위 단계를 거치면서 단순한 소스 코드가 최종적으로는 실행 가능한 애플리케이션으로 변환됨
    - 젠킨스 자동화 서버 : 도메인 특화 언어(DSL, Domain Specific Language)로 이러한 빌드 수명 주기 단계를 구축
      - 애플리케이션은 다양한 빌드 단계를 거치면서 빌드 도구, 정적 분석 도구 , 여러 종류의 소스 코드 관리 도구 등 다양한 분야의 도구 사용
    
    2-3. 젠킨스 아키텍처
    
    - 개발자와 테스터가 젠킨스를 사용하는 방법을 설명
    - 일반적인 젠킨스의 CI/CD 프로세스
      1. 다수의 개발자가 각자의 브랜치에서 변경 작업을 한 후, 이를 중앙 리포지터리로 푸시함
         코드 리뷰가 끝나면 이를 다른 브랜치(개발 브랜치)에 병합함
      2. 브랜치의 변경 사항이 젠킨스에 통보됨
      3. 젠킨스의 통보를 수신하면 작업을 시작함
    
    - 젠킨스의 작업이란 빌드 릴리스 수명 주기의 여러 단계를 수행하기 위해 순차적 프로세스로 구현한 태스크 및 하위 태스크를 말함
      일반적인 단계는 아래와 같다
      1. (사용 중인) 소스 코드 관리 시스템에 맞는 플로그인(예시, 깃 플러그인)을 사용해 리포지터리에서 변경된 파일을 가져옴
      2. 메이븐 같은 빌드 도구와 관련 젠킨스 플러그인(예시, 메이븐 플러그인)을 사용해 변경된 파일들을 컴파일함
      3. 빌드 도구를 재사용해 컴파일된 코드의 단위/통합 테스트를 실행함
      4. 정적 분석 도구(소나큐브)를 실행해 코딩 표준을 준수하는지와 데드 코드가 있는지를 확인
      5. 컴파일/테스트까지 완료된 파일들을 `.jar`, `.war` 같은 라이브러리 형태로 번들링함 (젠킨스 플러그인으로 실행되는 빌드 도구 사용)
      6. 빌드된 라이브러리 파일을 테스트/프로덕션 환경으로 배포
      7. E-E 테스트 자동화 도구(셀레늄/프로트랙터 같은 UI 자동화 도구)를 사용해 배포된 애플리케이션을 대상으로 테스트 실행
      8. 새로 생성된 애플리케이션의 상태와 E-E 테스트 결과가 포함된 이메일을 프로젝트 팀원들에게 전송
    
    # 3. 젠킨스 설치
    
    ---
    
    3-1. 하드웨어/소프트웨어 요구사항
    
    - 하드웨어
      - 256MB의 메모리 용량
      - 1GB이상의 하드디스크 용량(도커 컨테이너로 실행하는 경우에는 10GB 이상 추천)
    - 소프트웨어
      - 자바: 젠킨스 버전에 따라 지원하는 버전이 다름 (https://get.jenkins.io/war-stable/)
        - JDK11/JDK17 : 젠킨스 버전 2.357, LTS버전 2.351.1 이후
        - JDK8/JDK11 : 젠킨스 버전 2.164.1, LTS버전 2.236.1 이하 버전
    
    3-2. 다양한 젠킨스 설치 방법
    
    1. MSI 인스톨러로 설치
       - [다운로드](https://www.jenkins.io/download/thank-you-downloading-windows-installer/)
       - [파일 실행 후 설치](https://www.jenkins.io/doc/book/installing/windows/)
    2. `.war` 파일로 설치
       - [다운로드](https://get.jenkins.io/war/2.290/jenkins.war)
       - [젠킨스 설치](https://www.jenkins.io/doc/book/installing/war-file/)
    3. 도커 이미지로 설치
       - 도커는 애플케이션을 빌드하고 배포하는 도구의 하나로서 코드 및 관련 의존성 요소를 모두 컨테이너라고 부르는 배포 단위에 패키징하는 방식
       - 기존에는 물리적 시스템을 에뮬레이트하는 가상 머신을 많이 사용했으나, 도커는 가상 머신보다 헐신 가벼우며, 애플리케이션 구성을 코드 방식으로 작성할 수 도 있음
       - [젠킨스 설치](https://www.jenkins.io/doc/book/installing/docker/)
    
    - [맥에서 설치하기](https://www.jenkins.io/doc/book/installing/macos/)
      - 샘플 명령
        - 최신 LTS 버전을 설치합니다. brew install jenkins-lts
        - Jenkins 서비스를 시작합니다. brew services start jenkins-lts
        - Jenkins 서비스를 다시 시작합니다. brew services restart jenkins-lts
        - Jenkins 버전을 업데이트합니다. brew upgrade jenkins-lts
        - Jenkins 서비스를 시작한 후 http://localhost:8080으로 이동하여 지침에 따라 설치를 완료합니다. 설치 지침은 외부 자료도 참조하세요. 예를 들어 이 블로그 게시물에서는 설치 프로세스를 설명합니다.